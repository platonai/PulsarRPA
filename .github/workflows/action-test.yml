name: Action Test Workflow

on:
  workflow_dispatch:

jobs:
  analyze:
    name: Analyze
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      security-events: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17
          cache: maven

      - name: Cache Maven packages
        uses: actions/cache@v3
        with:
          path: ~/.m2
          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
          restore-keys: ${{ runner.os }}-m2

      - name: Setup Environment
        id: setup
        uses: ./.github/actions/setup-environment
        with:
          java_version: '17'

      - name: Update Documentation
        uses: ./.github/actions/update-docs
        if: success()
        with:
          version: ${{ env.VERSION }}
          files: '["README.md", "README-CN.md"]'
          commit_message: 'docs: update version references to v{version}'
          push_changes: 'true'
