<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Session Instructions Demo</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        body { font-family: system-ui, Arial, sans-serif; margin:0; padding:0 1rem 4rem; line-height:1.5; }
        header { background:#111827; color:#fff; padding:1rem; margin:0 -1rem 1rem; }
        nav a { color:#93c5fd; margin-right:1rem; text-decoration:none; }
        nav a:hover { text-decoration:underline; }
        #title { margin:0 0 1rem; }
        form.search { margin:1rem 0; display:flex; gap:.5rem; }
        form.search input { flex:1; padding:.5rem .75rem; font-size:1rem; }
        form.search button { padding:.55rem 1rem; font-size:1rem; cursor:pointer; }
        .hint { font-size:.85rem; color:#555; }
        ul#articleList { list-style:none; padding:0; margin:1rem 0; }
        ul#articleList li { padding:.4rem .3rem; border-bottom:1px solid #e5e7eb; display:flex; gap:.75rem; flex-wrap:wrap; }
        .title a { font-weight:600; color:#1d4ed8; text-decoration:none; }
        .title a:hover { text-decoration:underline; }
        .comments-link { font-size:.8rem; color:#6b7280; text-decoration:none; margin-left:auto; }
        .comments-link:hover { text-decoration:underline; }
        .results { border:1px solid #e5e7eb; padding:.75rem; border-radius:6px; margin:1rem 0; background:#f9fafb; }
        .results.hidden { display:none; }
        .badge { background:#f3f4f6; border:1px solid #d1d5db; padding:2px 6px; border-radius:4px; font-size:.65rem; letter-spacing:.5px; text-transform:uppercase; }
        .infinite-loading { text-align:center; padding:1rem; color:#6b7280; }
        .comment-thread { border:1px solid #d1d5db; border-radius:6px; padding:.75rem; margin:.5rem 0; background:#fff; }
        .comment-thread[hidden] { display:none; }
        .comment { margin:.5rem 0; }
        .deep { margin-left:1.25rem; border-left:2px solid #e5e7eb; padding-left:.75rem; }
        footer { position:fixed; bottom:0; left:0; right:0; background:#111827; color:#fff; font-size:.75rem; padding:.35rem .75rem; }
        .screen-tall { height:1400px; }
        .pill { display:inline-block; background:#e0f2fe; color:#0369a1; padding:2px 8px; border-radius:999px; font-size:.65rem; margin-right:.4rem; }
        .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }
        .action-log { font-family:monospace; font-size:.75rem; max-height:160px; overflow:auto; background:#0f172a; color:#e2e8f0; padding:.5rem .75rem; border-radius:4px; }
        .action-log-entry { border-bottom:1px solid #334155; padding:.25rem 0; }
        .action-log-entry:last-child { border-bottom:none; }
    </style>
</head>
<body>
<header>
    <h1 id="title">Session Instructions Demo</h1>
    <nav aria-label="Primary">
        <!-- 3+ links so that "click the 3rd link" has a deterministic target (Link C) -->
        <a href="pageA.html">Link A</a>
        <a href="pageB.html">Link B</a>
        <a href="pageC.html" id="thirdLink">Link C</a>
        <a href="#" id="noopLink" onclick="event.preventDefault()">Link D</a>
    </nav>
    <p class="hint">Local test page simulating actions for SessionInstructionsExample (search, link navigation, Show/Ask HN, infinite scroll, comments, etc.).</p>
</header>

<section aria-labelledby="searchSection">
    <h2 id="searchSection">Search</h2>
    <form id="searchForm" class="search" role="search" aria-label="Site search">
        <label class="sr-only" for="searchBox">Search</label>
        <input id="searchBox" name="q" type="search" placeholder="Search…" autocomplete="off" />
        <button type="submit">Search</button>
    </form>
    <div id="searchResults" class="results hidden" aria-live="polite"></div>
</section>

<section aria-labelledby="articlesHeader">
    <h2 id="articlesHeader">Article List (HN-like)</h2>
    <ul id="articleList">
        <li class="athing" data-rank="1">
            <span class="title"><a href="page2.html">Show HN: Demo Project</a></span>
            <a href="#" class="comments-link" data-thread="c1">comments</a>
        </li>
        <li class="athing" data-rank="2">
            <span class="title"><a href="page3.html">Ask HN: Need help with scraping</a></span>
            <a href="#" class="comments-link" data-thread="c2">comments</a>
        </li>
        <li class="athing" data-rank="3">
            <span class="title"><a href="page4.html">Discussion: Web Agents</a></span>
            <a href="#" class="comments-link" data-thread="c3">comments</a>
        </li>
        <li class="athing" data-rank="4">
            <span class="title"><a href="page5.html">Another Link</a></span>
            <a href="#" class="comments-link" data-thread="c4">comments</a>
        </li>
    </ul>
    <div id="infiniteMarker" class="infinite-loading">Scroll to bottom to load more…</div>
</section>

<section aria-labelledby="commentsHeader">
    <h2 id="commentsHeader">Comment Threads</h2>
    <p class="hint">"open the first comment thread" should expand Thread 1 below.</p>
    <div class="comment-thread" id="thread-c1" hidden>
        <strong>Thread 1</strong>
        <div class="comment">UserA: This is a demo comment.</div>
        <div class="comment deep">UserB: A reply to the demo comment.</div>
    </div>
    <div class="comment-thread" id="thread-c2" hidden>
        <strong>Thread 2</strong>
        <div class="comment">UserC: Another comment.</div>
    </div>
</section>

<section aria-labelledby="actionsHeader">
    <h2 id="actionsHeader">Action Log</h2>
    <div id="actionLog" class="action-log" aria-live="polite"></div>
</section>

<div class="screen-tall" aria-hidden="true"></div>

<footer>
    Local Demo • Supports: search, 3rd link navigation, Show/Ask HN link, scroll load, comment thread, extraction (.athing .title a), navigation history.
</footer>

<script>
(function() {
    const logEl = document.getElementById('actionLog');
    function log(msg) {
        const div = document.createElement('div');
        div.className = 'action-log-entry';
        div.textContent = new Date().toLocaleTimeString() + ' - ' + msg;
        logEl.prepend(div);
    }

    // SEARCH HANDLER
    const searchForm = document.getElementById('searchForm');
    const searchBox = document.getElementById('searchBox');
    const searchResults = document.getElementById('searchResults');
    searchForm.addEventListener('submit', e => {
        e.preventDefault();
        const q = searchBox.value.trim();
        log('Search submitted: ' + q);
        if (!q) {
            searchResults.innerHTML = '<em>No query</em>'; searchResults.classList.remove('hidden'); return;
        }
        searchResults.classList.remove('hidden');
        searchResults.innerHTML = '<div class="badge">RESULTS</div>' +
            '<p>Results for <strong>' + q.replace(/</g,'&lt;') + '</strong></p>' +
            '<ul>' +
            [1,2,3].map(i => '<li class="athing"><span class="title"><a href="pageResult'+i+'.html">' + q + ' result #' + i + '</a></span></li>').join('') +
            '</ul>';
        // Smooth scroll to results to imitate dynamic page update
        searchResults.scrollIntoView({behavior:'smooth'});
    });

    // COMMENTS HANDLER (open first thread)
    const commentLinks = document.querySelectorAll('.comments-link');
    commentLinks.forEach(a => {
        a.addEventListener('click', evt => {
            evt.preventDefault();
            const id = 'thread-' + a.dataset.thread;
            const thread = document.getElementById(id);
            if (thread) { thread.hidden = !thread.hidden; log('Toggled comment thread ' + id); }
        });
    });

    // Provide a deterministic element maybe used by natural language: "open the first comment thread"
    // We'll auto-open thread 1 if instruction triggers a click on an element with text that starts with "comments" and data-thread=c1

    // INFINITE SCROLL
    let extraLoaded = 0;
    function loadMore() {
        if (extraLoaded >= 2) return; // load twice only
        const list = document.getElementById('articleList');
        for (let i = 1; i <= 5; i++) {
            const li = document.createElement('li');
            li.className = 'athing';
            const rank = list.children.length + 1;
            li.dataset.rank = rank;
            li.innerHTML = '<span class="title"><a href="pageExtra'+extraLoaded+'_'+i+'.html">Extra Loaded Item ' + rank + '</a></span>';
            list.appendChild(li);
        }
        log('Loaded more articles batch #' + (extraLoaded+1));
        extraLoaded++;
        if (extraLoaded >= 2) {
            document.getElementById('infiniteMarker').textContent = 'No more content.';
        }
    }

    window.addEventListener('scroll', () => {
        const marker = document.getElementById('infiniteMarker');
        const rect = marker.getBoundingClientRect();
        if (rect.top < window.innerHeight + 40) {
            loadMore();
        }
    });

    // Utility to detect a natural language attempt (heuristic if automation scripts type into search input programmatically)
    // Not strictly required; logging only.
    const observer = new MutationObserver(muts => {
        for (const m of muts) {
            if (m.type === 'childList') {
                log('DOM changed in #' + m.target.id);
            }
        }
    });
    observer.observe(document.getElementById('articleList'), {childList:true});

    log('Page initialized');
})();
</script>
</body>
</html>

