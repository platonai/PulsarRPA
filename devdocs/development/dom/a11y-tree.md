# href å±æ€§æµè½¬å›¾

## å®Œæ•´æ•°æ®æµï¼ˆCDP â†’ NanoDOMTreeï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Chrome DevTools Protocol                      â”‚
â”‚                                                                       â”‚
â”‚  DOM.getDocument() è¿”å›:                                             â”‚
â”‚  {                                                                    â”‚
â”‚    nodeId: 123,                                                      â”‚
â”‚    nodeName: "A",                                                    â”‚
â”‚    attributes: ["href", "https://example.com", "class", "link"]      â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                    â”‚ æ‰å¹³åˆ—è¡¨æ ¼å¼                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ç¬¬ä¸€å±‚ï¼šDomTreeHandler.mapNode()                      â”‚
â”‚                 æ–‡ä»¶ï¼šDomTreeHandler.kt (93-96è¡Œ)                     â”‚
â”‚                                                                       â”‚
â”‚  val attrs = node.attributes.chunked(2).associate { (k,v) -> k to v }â”‚
â”‚                                                                       â”‚
â”‚  ç»“æœ: Map<String, String>                                            â”‚
â”‚  {                                                                    â”‚
â”‚    "href" -> "https://example.com",  âœ… href å­˜åœ¨                    â”‚
â”‚    "class" -> "link"                                                 â”‚
â”‚  }                                                                   â”‚
â”‚                                                                       â”‚
â”‚  å­˜å‚¨åˆ°: DOMTreeNodeEx.attributes                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç¬¬äºŒå±‚ï¼šDOMStateBuilder.cleanOriginalNodeEnhanced()         â”‚
â”‚                 æ–‡ä»¶ï¼šDomStateBuilder.kt (311-406è¡Œ)                  â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ æ­¥éª¤1: è·å–ç™½åå•                                      â”‚            â”‚
â”‚  â”‚ includeAttributes = DefaultIncludeAttributes.ATTRIBUTESâ”‚            â”‚
â”‚  â”‚                                                        â”‚            â”‚
â”‚  â”‚ ä¿®å¤å‰: ["title", "type", "id", ...]  âŒ æ—  "href"    â”‚            â”‚
â”‚  â”‚ ä¿®å¤å: ["href", "src", "title", ...] âœ… æœ‰ "href"   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                          â”‚                                            â”‚
â”‚                          â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ æ­¥éª¤2: è¿‡æ»¤å±æ€§                                       â”‚            â”‚
â”‚  â”‚ val filteredAttrs = node.attributes.filterKeys { key ->â”‚            â”‚
â”‚  â”‚   key.lowercase() in includeAttributes                â”‚            â”‚
â”‚  â”‚ }                                                      â”‚            â”‚
â”‚  â”‚                                                        â”‚            â”‚
â”‚  â”‚ ä¿®å¤å‰:                                                â”‚            â”‚
â”‚  â”‚ "href".lowercase() in includeAttributes = false âŒ     â”‚            â”‚
â”‚  â”‚ ç»“æœ: { "class" -> "link" } - href è¢«è¿‡æ»¤æ‰           â”‚            â”‚
â”‚  â”‚                                                        â”‚            â”‚
â”‚  â”‚ ä¿®å¤å:                                                â”‚            â”‚
â”‚  â”‚ "href".lowercase() in includeAttributes = true âœ…      â”‚            â”‚
â”‚  â”‚ ç»“æœ: { "href" -> "...", "class" -> "link" }          â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                          â”‚                                            â”‚
â”‚                          â–¼                                            â”‚
â”‚  CleanedDOMTreeNode(                                                 â”‚
â”‚    attributes = filteredAttrs  // âœ… ä¿®å¤ååŒ…å« href                 â”‚
â”‚  )                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç¬¬ä¸‰å±‚ï¼šMicroDOMTreeNodeHelper.newNode()                 â”‚
â”‚                 æ–‡ä»¶ï¼šMicroDOMTreeNodeHelper.kt (77-96è¡Œ)             â”‚
â”‚                                                                       â”‚
â”‚  val o = n?.originalNode  // CleanedDOMTreeNode                      â”‚
â”‚                                                                       â”‚
â”‚  NanoDOMTree(                                                        â”‚
â”‚    attributes = o.attributes  // ç›´æ¥å¤åˆ¶ï¼Œæ— æ³•æ¢å¤å·²ä¸¢å¤±çš„å±æ€§       â”‚
â”‚  )                                                                   â”‚
â”‚                                                                       â”‚
â”‚  ä¿®å¤å‰: { "class" -> "link" }          âŒ href å·²ä¸¢å¤±ï¼Œæ— æ³•æ¢å¤     â”‚
â”‚  ä¿®å¤å: { "href" -> "...", "class" -> "link" }  âœ… href ä¿ç•™       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æœ€ç»ˆè¾“å‡ºï¼šNanoDOMTree                        â”‚
â”‚                                                                       â”‚
â”‚  {                                                                    â”‚
â”‚    "locator": "0,101",                                               â”‚
â”‚    "nodeName": "a",                                                  â”‚
â”‚    "attributes": {                                                   â”‚
â”‚      "href": "https://example.com",  âœ… href å±æ€§å­˜åœ¨                â”‚
â”‚      "class": "link"                                                 â”‚
â”‚    }                                                                 â”‚
â”‚  }                                                                   â”‚
â”‚                                                                       â”‚
â”‚  åºåˆ—åŒ–ä¸º JSON ä¾› LLM ä½¿ç”¨                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…³é”®ç‚¹æ€»ç»“

### ğŸ”´ é—®é¢˜ç‚¹ï¼ˆä¿®å¤å‰ï¼‰
**ä½ç½®**: `DOMStateBuilder.cleanOriginalNodeEnhanced()` - ç¬¬ 311-319 è¡Œ

```kotlin
val filteredAttrs = node.attributes.filterKeys { key ->
    key.lowercase() in includeAttributes  // âŒ "href" ä¸åœ¨ç™½åå•ä¸­
}
```

### ğŸŸ¢ ä¿®å¤ç‚¹
**ä½ç½®**: `DefaultIncludeAttributes.ATTRIBUTES` - ç¬¬ 65-83 è¡Œ

```kotlin
object DefaultIncludeAttributes {
    val ATTRIBUTES = listOf(
        "href", "src", "action",  // âœ… æ–°å¢å¯¼èˆªå±æ€§
        // ...
    )
}
```

### ğŸ“Š å½±å“èŒƒå›´
```
DefaultIncludeAttributes.ATTRIBUTES (ä¿®æ”¹)
    â†“
DOMStateBuilder.build() (ä½¿ç”¨)
    â†“
CleanedDOMTreeNode (åŒ…å« href)
    â†“
MicroDOMTreeNode (åŒ…å« href)
    â†“
NanoDOMTree (åŒ…å« href) â†’ ä¾› LLM ä½¿ç”¨
InteractiveDOMTreeNode (åŒ…å« href) â†’ ä¾›äº¤äº’ä½¿ç”¨
```

### âœ… æ–°å¢å±æ€§åˆ—è¡¨
| å±æ€§ | å…ƒç´ ç¤ºä¾‹ | ç”¨é€” |
|------|---------|------|
| `href` | `<a href="...">` | é“¾æ¥ç›®æ ‡ |
| `src` | `<img src="...">` | èµ„æºURL |
| `action` | `<form action="...">` | è¡¨å•æäº¤åœ°å€ |
| `target` | `<a target="_blank">` | æ‰“å¼€æ–¹å¼ |
| `rel` | `<a rel="noopener">` | é“¾æ¥å…³ç³» |
| `download` | `<a download>` | ä¸‹è½½æ ‡è®° |
| `class` | `<div class="...">` | CSSç±»å |
